<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moonlight Line - Create Team</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="/assets/js/team-utils.js"></script>
    <script src="/assets/js/background-music.js"></script>
    <style>
            * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Orbitron', sans-serif;
        }

        html {
            height: 100%;
            overflow-x: hidden;
            overflow-y: auto;
        }

        body {
            background-color: #06111f;
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
            overflow-y: auto;
            padding-bottom: 40px;
            position: relative;
        }

        /* üé¨ FONDO GIF ANIMADO IGUAL AL INDEX */
        .bg-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -3;
            overflow: hidden;
        }

        .bg-gif {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
        }

        /* Overlay oscuro para legibilidad */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: -2;
        }

        /* Grid Lines */
        .grid-lines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(to right, rgba(0, 240, 255, 0.07) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(0, 240, 255, 0.07) 1px, transparent 1px);
            background-size: 30px 30px;
            pointer-events: none;
            z-index: -1;
        }

        /* üåü LOGOS DECORATIVOS DE EQUIPOS FLOTANTES */
        .team-logos {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: auto;
            z-index: 0;
        }

        .team-logo {
            position: absolute;
            width: 150px;
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.8;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: float 20s ease-in-out infinite;
        }

        .team-logo img {
            width: 150px;
            height: 150px;
            object-fit: contain;
            filter: drop-shadow(0 0 15px rgba(0, 240, 255, 0.6));
            transition: all 0.3s ease;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(30px, -20px) rotate(5deg); }
            50% { transform: translate(-20px, 30px) rotate(-3deg); }
            75% { transform: translate(20px, -10px) rotate(2deg); }
        }

        .team-logo:hover img {
            transform: scale(1.05);
            filter: drop-shadow(0 0 20px rgba(0, 240, 255, 0.9));
        }

        .team-logo:active img {
            transform: scale(0.95);
        }

        /* POSICIONES DE LOGOS */
        .logo-angelbee {
            top: 15%;
            left: 8%;
            animation-delay: 0s;
        }

        .logo-armonia {
            top: 60%;
            left: 5%;
            animation-delay: 3s;
        }

        .logo-raptors {
            top: 80%;
            left: 15%;
            animation-delay: 6s;
        }

        .logo-titans {
            top: 20%;
            right: 8%;
            animation-delay: 2s;
        }

        .logo-tmt {
            top: 65%;
            right: 5%;
            animation-delay: 5s;
        }

        .logo-warriors {
            top: 85%;
            right: 15%;
            animation-delay: 8s;
        }

        /* üî• EFECTOS GLOW LATERALES */
        .side-glow-left {
            position: fixed;
            left: 0;
            top: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(to bottom, #00f0ff, transparent);
            box-shadow: 0 0 30px 8px rgba(0, 240, 255, 0.6);
            opacity: 0.8;
            z-index: 0;
        }

        .side-glow-right {
            position: fixed;
            right: 0;
            top: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(to bottom, #ff8c00, transparent);
            box-shadow: 0 0 30px 8px rgba(255, 140, 0, 0.6);
            opacity: 0.8;
            z-index: 0;
        }

        /* ‚ú® C√çRCULOS DECORATIVOS FLOTANTES */
        .decorative-circle {
            position: fixed;
            border-radius: 50%;
            z-index: 0;
            opacity: 0.3;
            pointer-events: none;
            animation: pulse-glow 6s ease-in-out infinite alternate;
        }

        .circle-top-left {
            width: 400px;
            height: 400px;
            top: -100px;
            left: -100px;
            background: radial-gradient(circle, rgba(0, 240, 255, 0.2) 0%, rgba(0, 240, 255, 0) 70%);
            animation-delay: 0s;
        }

        .circle-bottom-right {
            width: 500px;
            height: 500px;
            bottom: -150px;
            right: -150px;
            background: radial-gradient(circle, rgba(255, 140, 0, 0.15) 0%, rgba(255, 140, 0, 0) 70%);
            animation-delay: 3s;
        }

        .circle-center {
            width: 300px;
            height: 300px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle, rgba(140, 0, 255, 0.1) 0%, rgba(140, 0, 255, 0) 70%);
            animation-delay: 1.5s;
        }

        @keyframes pulse-glow {
            0% { transform: scale(1) rotate(0deg); opacity: 0.3; }
            50% { transform: scale(1.1) rotate(180deg); opacity: 0.5; }
            100% { transform: scale(1) rotate(360deg); opacity: 0.3; }
        }

        /* CONTENIDO PRINCIPAL */
        .team-creation-screen {
            position: relative;
            z-index: 10;
            width: 100%;
            max-width: 1200px;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 30px;
            align-items: center;
            background: rgba(0, 0, 0, 0.4);
            padding: 15px 25px;
            border-radius: 15px;
            border: 1px solid rgba(0, 240, 255, 0.3);
            backdrop-filter: blur(10px);
            box-shadow: 0 0 30px rgba(0, 240, 255, 0.2);
        }

        .logo {
            font-size: 1.8rem;
            color: #00f0ff;
            text-shadow: 0 0 20px rgba(0, 240, 255, 0.8);
            font-weight: 700;
            letter-spacing: 1px;
            animation: logo-glow 3s ease-in-out infinite alternate;
        }

        @keyframes logo-glow {
            0% { text-shadow: 0 0 20px rgba(0, 240, 255, 0.8); }
            100% { text-shadow: 0 0 30px rgba(0, 240, 255, 1), 0 0 40px rgba(0, 240, 255, 0.5); }
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
        }

        .nav-button, .draft-button {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.8));
            border: 2px solid #00f0ff;
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.4s ease;
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.3);
        }

        .nav-button::before, .draft-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 240, 255, 0.4), transparent);
            transition: left 0.5s ease;
        }

        .nav-button:hover::before, .draft-button:hover::before {
            left: 100%;
        }

        .nav-button:hover, .draft-button:hover {
            background: linear-gradient(135deg, rgba(0, 240, 255, 0.1), rgba(0, 240, 255, 0.2));
            box-shadow: 0 0 30px rgba(0, 240, 255, 0.6), inset 0 0 20px rgba(0, 240, 255, 0.1);
            transform: translateY(-3px) scale(1.05);
            border-color: #00f0ff;
        }

        .draft-button {
            border-color: #ff8c00;
            color: #ff8c00;
            box-shadow: 0 0 20px rgba(255, 140, 0, 0.3);
        }

        .draft-button:hover {
            background: linear-gradient(135deg, rgba(255, 140, 0, 0.1), rgba(255, 140, 0, 0.2));
            box-shadow: 0 0 30px rgba(255, 140, 0, 0.6), inset 0 0 20px rgba(255, 140, 0, 0.1);
            border-color: #ff8c00;
        }

        .section-title {
            font-size: 2.5rem;
            color: #00f0ff;
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(0, 240, 255, 0.8);
            text-transform: uppercase;
            letter-spacing: 3px;
            text-align: center;
            animation: title-pulse 4s ease-in-out infinite alternate;
        }

        @keyframes title-pulse {
            0% { 
                text-shadow: 0 0 20px rgba(0, 240, 255, 0.8);
                transform: scale(1);
            }
            100% { 
                text-shadow: 0 0 30px rgba(0, 240, 255, 1), 0 0 50px rgba(0, 240, 255, 0.5);
                transform: scale(1.02);
            }
        }

        /* STATUS DE JORNADA MEJORADO */
        .jornada-status {
            background: linear-gradient(135deg, rgba(0, 255, 128, 0.1), rgba(0, 255, 128, 0.05));
            border: 2px solid #00ff80;
            border-radius: 15px;
            padding: 20px 25px;
            margin-bottom: 25px;
            text-align: center;
            color: #00ff80;
            font-size: 1rem;
            line-height: 1.6;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 30px rgba(0, 255, 128, 0.3);
            position: relative;
            overflow: hidden;
        }

        .jornada-status::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 128, 0.2), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .jornada-status.locked {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(255, 107, 107, 0.05));
            border-color: #ff6b6b;
            color: #ff6b6b;
            box-shadow: 0 0 30px rgba(255, 107, 107, 0.3);
        }

        .jornada-status.warning {
            background: linear-gradient(135deg, rgba(255, 140, 0, 0.1), rgba(255, 140, 0, 0.05));
            border-color: #ff8c00;
            color: #ff8c00;
            box-shadow: 0 0 30px rgba(255, 140, 0, 0.3);
        }

        .status-icon {
            font-size: 1.4rem;
            margin-right: 10px;
            animation: icon-bounce 2s ease-in-out infinite;
        }

        @keyframes icon-bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* CANCHA MEJORADA */
        .court-container {
            width: 100%;
            max-width: 1200px;
            position: relative;
            margin-bottom: 30px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(0, 240, 255, 0.2);
            box-shadow: 0 0 40px rgba(0, 240, 255, 0.2);
        }

        .court {
            width: 100%;
            aspect-ratio: 2/1;
            background: linear-gradient(135deg, rgba(0, 50, 30, 0.8), rgba(0, 30, 20, 0.9));
            border: 3px solid #00f0ff;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 0 30px rgba(0, 240, 255, 0.4),
                inset 0 0 50px rgba(0, 240, 255, 0.1);
        }

        /* üîß CARTAS DE JUGADORES - DISE√ëO EXACTO DE DRAFT-PLAYERS */
        .player-card {
            width: 140px !important;
            height: 200px !important;
            background: linear-gradient(145deg, rgba(20, 30, 40, 0.9), rgba(10, 20, 30, 0.95));
            border: 3px solid transparent;
            border-image: linear-gradient(45deg, #ff8c00, #ffa500, #ff7f00, #ff8c00) 1;
            position: relative;
            box-shadow: 
                0 0 15px rgba(255, 140, 0, 0.4),
                inset 0 0 8px rgba(255, 140, 0, 0.1);
            font-family: 'Orbitron', monospace;
            overflow: hidden;
            cursor: grab;
            transition: all 0.4s ease;
            backdrop-filter: blur(10px);
            border-radius: 8px;
            display: flex !important;
            flex-direction: column;
            justify-content: space-between;
            margin: 0 !important;
            z-index: 100;
        }

        .player-card:active {
            cursor: grabbing;
        }

        .player-card:hover {
            transform: scale(1.05) translateY(-5px);
            box-shadow: 
                0 15px 30px rgba(255, 140, 0, 0.6),
                inset 0 0 12px rgba(255, 140, 0, 0.2);
            border-image: linear-gradient(45deg, #ffa500, #ffb500, #ffa500, #ffb500) 1;
        }

        /* Elementos internos de la carta */
        .card-border {
            position: absolute;
            top: 4px;
            left: 4px;
            right: 4px;
            bottom: 4px;
            border: 1px solid #ff8c00;
            pointer-events: none;
            border-radius: 4px;
        }

        .corner {
            position: absolute;
            width: 10px;
            height: 10px;
            background: linear-gradient(45deg, #ff8c00, #ffa500);
        }

        .corner.top-left {
            top: 0;
            left: 0;
            clip-path: polygon(0 0, 100% 0, 0 100%);
        }

        .corner.top-right {
            top: 0;
            right: 0;
            clip-path: polygon(0 0, 100% 0, 100% 100%);
        }

        .corner.bottom-left {
            bottom: 0;
            left: 0;
            clip-path: polygon(0 0, 100% 100%, 0 100%);
        }

        .corner.bottom-right {
            bottom: 0;
            right: 0;
            clip-path: polygon(100% 0, 100% 100%, 0 100%);
        }

        .player-name {
            background: linear-gradient(90deg, #ff8c00, #ffa500, #ff8c00);
            color: #000;
            text-align: center;
            padding: 4px 6px;
            margin: 6px 6px 4px 6px;
            font-weight: 900;
            font-size: 9px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            border: 1px solid #ff7f00;
            text-shadow: 1px 1px 0 rgba(0,0,0,0.3);
            border-radius: 3px;
        }

        .player-position {
            background: rgba(255, 140, 0, 0.2);
            color: #ffa500;
            text-align: center;
            padding: 2px 4px;
            margin: 0 6px 6px 6px;
            font-weight: 600;
            font-size: 7px;
            letter-spacing: 0.3px;
            border: 1px solid #ff8c00;
            text-transform: uppercase;
            border-radius: 2px;
        }

        .player-image-container {
            width: 100px;
            height: 70px;
            margin: 0 auto 8px auto;
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            border: 2px solid #ff8c00;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 8px rgba(0,0,0,0.5);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .team-logo-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 0 6px rgba(255, 140, 0, 0.6));
            transition: all 0.3s ease;
            padding: 8px;
            display: block;
        }

        .player-card:hover .team-logo-image {
            transform: scale(1.05);
            filter: drop-shadow(0 0 10px rgba(255, 140, 0, 0.8));
        }

        .stats-container {
            padding: 0 8px 6px 8px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3px 6px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 7px;
            font-weight: 600;
            color: #e6d7c3;
            letter-spacing: 0.2px;
            text-transform: uppercase;
        }

        .stat-label {
            color: #ffa500;
        }

        .stat-value {
            color: #e6d7c3;
            font-weight: 700;
            min-width: 15px;
            text-align: right;
        }

        /* üîß SLOTS DE JUGADORES - AJUSTADOS PARA MOSTRAR CARTAS CORRECTAMENTE */
        .player-slot, .bench-slot {
            position: absolute;
            width: 150px;
            height: 210px;
            background: linear-gradient(135deg, rgba(0, 255, 128, 0.15), rgba(0, 255, 128, 0.05));
            border: 3px solid #00ff80;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.4s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0, 255, 128, 0.4);
            backdrop-filter: blur(5px);
            z-index: 50;
        }

        .player-slot:hover, .bench-slot:hover {
            transform: scale(1.02) translateY(-3px);
            border-color: #00ff80;
            box-shadow: 0 8px 25px rgba(0, 255, 128, 0.6);
            background: linear-gradient(135deg, rgba(0, 255, 128, 0.25), rgba(0, 255, 128, 0.15));
        }

        .bench-slot {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.15), rgba(255, 107, 107, 0.05));
            border-color: #ff6b6b;
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.4);
        }

        .bench-slot:hover {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.25), rgba(255, 107, 107, 0.15));
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.6);
            border-color: #ff6b6b;
        }

        /* TEXTO CUANDO LOS SLOTS EST√ÅN VAC√çOS */
        .empty-slot {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.75rem;
            text-align: center;
            font-weight: 600;
            line-height: 1.3;
            padding: 10px;
            pointer-events: none;
        }

        /* üîß CUANDO EL SLOT TIENE UN JUGADOR */
        .player-slot.has-player, .bench-slot.has-player {
            padding: 0 !important;
            background: transparent !important;
            border-color: rgba(255, 255, 255, 0.3) !important;
        }

        .player-slot.has-player .player-card,
        .bench-slot.has-player .player-card {
            position: relative !important;
            z-index: 100 !important;
        }

        /* BOTONES DE ACCI√ìN MEJORADOS */
        .action-buttons {
            display: flex;
            gap: 25px;
            width: 100%;
            max-width: 1200px;
            justify-content: center;
            margin: 30px 0;
        }

        .action-buttons .nav-button {
            padding: 15px 35px;
            font-size: 1.1rem;
            border-radius: 30px;
            font-weight: 700;
            letter-spacing: 2px;
        }

        /* Mantener todas las posiciones y l√≥gica existente */
        .center-line, .free-throw-left, .free-throw-right, .backboard-left, .backboard-right {
            position: absolute;
            background-color: #00f0ff;
            box-shadow: 0 0 8px rgba(0, 240, 255, 0.6);
        }

        .center-line {
            top: 0;
            left: 50%;
            height: 100%;
            width: 2px;
        }

        .center-circle, .free-throw-circle-left, .free-throw-circle-right {
            position: absolute;
            border: 2px solid #00f0ff;
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(0, 240, 255, 0.6);
        }

        .center-circle {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 150px;
            height: 150px;
        }

        /* Mantener todas las dem√°s posiciones de la cancha */
        .three-point-left, .three-point-right, .key-left, .key-right {
            position: absolute;
            top: 50%;
            border: 2px solid #00f0ff;
            box-shadow: 0 0 8px rgba(0, 240, 255, 0.6);
            transform: translateY(-50%);
        }

        .three-point-left {
            left: 0;
            width: 40%;
            height: 80%;
            border-radius: 0 33% 33% 0 / 50% 50% 50% 50%;
            border-left: none;
        }

        .three-point-right {
            right: 0;
            width: 40%;
            height: 80%;
            border-radius: 33% 0 0 33% / 50% 50% 50% 50%;
            border-right: none;
        }

        .key-left {
            left: 0;
            width: 19%;
            height: 40%;
            border-left: none;
        }

        .key-right {
            right: 0;
            width: 19%;
            height: 40%;
            border-right: none;
        }

        /* Posiciones de slots - mantener todas */
        .slot-left {
            top: 25%;
            left: 20%;
            transform: translate(-50%, -50%);
        }

        .slot-center {
            top: 75%;
            left: 20%;
            transform: translate(-50%, -50%);
        }

        .slot-top {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .slot-right {
            top: 25%;
            left: 80%;
            transform: translate(-50%, -50%);
        }

        .slot-bottom {
            top: 75%;
            left: 80%;
            transform: translate(-50%, -50%);
        }

        /* Resto de elementos de cancha */
        .free-throw-left, .free-throw-right {
            top: 50%;
            transform: translateY(-50%);
            width: 19%;
            height: 2px;
        }

        .free-throw-left { left: 0; }
        .free-throw-right { right: 0; }

        .free-throw-circle-left {
            left: 19%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
        }

        .free-throw-circle-right {
            right: 19%;
            top: 50%;
            transform: translate(50%, -50%);
            width: 100px;
            height: 100px;
        }

        .basket-left, .basket-right {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            border: 2px solid #00f0ff;
            border-radius: 50%;
            box-shadow: 0 0 12px rgba(0, 240, 255, 0.8);
        }

        .basket-left { left: 5%; }
        .basket-right { right: 5%; }

        .backboard-left {
            left: 2%;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 2px;
        }

        .backboard-right {
            right: 2%;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 2px;
        }

        /* √Åreas de bench */
        .bench-container, .bench-container-2 {
            width: 100%;
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            gap: 10px;
        }

        .bench-container-2 {
            margin-bottom: 15px;
        }

        /* RESPONSIVE MEJORADO */
        @media (max-width: 768px) {
            .team-logos { opacity: 0.3; }
            
            .navigation {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .section-title {
                font-size: 2rem;
            }
            
            .nav-button, .draft-button {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .decorative-circle {
                opacity: 0.2;
            }
            
            .player-card {
                width: 120px !important;
                height: 180px !important;
            }
            
            .player-slot, .bench-slot {
                width: 130px;
                height: 190px;
            }
            
            .player-image-container {
                width: 85px;
                height: 60px;
            }
            
            .player-name {
                font-size: 8px;
                padding: 3px 5px;
            }
            
            .player-position {
                font-size: 6px;
            }
            
            .stat-item {
                font-size: 6px;
            }
        }

        @media (max-width: 480px) {
            .team-logos .team-logo {
                width: 80px;
                height: 80px;
            }
            
            .team-logo img {
                width: 60px;
                height: 60px;
            }
            
            .player-card {
                width: 100px !important;
                height: 160px !important;
            }
            
            .player-slot, .bench-slot {
                width: 110px;
                height: 170px;
            }
            
            .player-image-container {
                width: 70px;
                height: 50px;
            }
            
            .stats-container {
                padding: 0 6px 4px 6px;
                gap: 2px 4px;
            }
        }
    </style>
</head>
<body>
    <!-- Fondo GIF igual al index -->
    <div class="bg-container">
        <img src="https://i.pinimg.com/originals/64/a8/08/64a8083d07b8c98923311cbc88fecafe.gif" alt="Basketball Court Background" class="bg-gif">
    </div>
    
    <!-- Overlay oscuro -->
    <div class="overlay"></div>
    
    <!-- Grid Lines -->
    <div class="grid-lines"></div>
    
    <!-- Logos decorativos flotantes -->
    <div class="team-logos">
        <div class="team-logo logo-angelbee">
            <img src="/assets/images/logos/angelbee.png" alt="Angel Bee Team">
        </div>
        <div class="team-logo logo-armonia">
            <img src="/assets/images/logos/armonia.png" alt="Armonia Team">
        </div>
        <div class="team-logo logo-raptors">
            <img src="/assets/images/logos/raptors.png" alt="Raptors Team">
        </div>
        <div class="team-logo logo-titans">
            <img src="/assets/images/logos/titans.png" alt="Titans Team">
        </div>
        <div class="team-logo logo-tmt">
            <img src="/assets/images/logos/tmt.png" alt="TMT Team">
        </div>
        <div class="team-logo logo-warriors">
            <img src="/assets/images/logos/warriors.png" alt="Warriors Team">
        </div>
    </div>
    
    <!-- Efectos glow laterales -->
    <div class="side-glow-left"></div>
    <div class="side-glow-right"></div>
    
    <!-- C√≠rculos decorativos -->
    <div class="decorative-circle circle-top-left"></div>
    <div class="decorative-circle circle-bottom-right"></div>
    <div class="decorative-circle circle-center"></div>
    
    <div class="team-creation-screen">
        <!-- Navegaci√≥n mejorada -->
        <div class="navigation">
            <div class="logo">MOONLIGHT LINE</div>
            <div class="nav-buttons">
                <a href="draft-players.html" class="draft-button" id="draft-button">DRAFT PLAYERS</a>
                <a href="index.html" class="nav-button">BACK</a>
                <button class="nav-button" id="save-team-btn">SAVE TEAM</button>
            </div>
        </div>
        
        <h2 class="section-title">CREATE YOUR TEAM</h2>
        
        <!-- Estado de la jornada -->
        <div class="jornada-status" id="jornada-status" style="display: none;">
            <span class="status-icon">‚ÑπÔ∏è</span>
            <span id="status-message">Loading game week status...</span>
        </div>
        
        <!-- Explicaci√≥n de zonas -->
        <div class="section-subtitle" style="font-size: 1.1rem; color: rgba(255, 255, 255, 0.8); margin-bottom: 30px; text-align: center; line-height: 1.6;">
            Place your players strategically! Only players in the <strong style="color: #00ff80;">GREEN ZONE</strong> will earn points.
        </div>
        
        <div style="display: flex; justify-content: center; gap: 40px; margin-bottom: 25px; flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 10px;">
                <div style="width: 20px; height: 20px; background: rgba(0, 255, 128, 0.3); border: 2px solid #00ff80; border-radius: 5px;"></div>
                <span style="color: #00ff80; font-weight: 600; font-size: 1rem;">GREEN ZONE: Starters (5 players) - EARN POINTS</span>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <div style="width: 20px; height: 20px; background: rgba(255, 107, 107, 0.3); border: 2px solid #ff6b6b; border-radius: 5px;"></div>
                <span style="color: #ff6b6b; font-weight: 600; font-size: 1rem;">RED ZONE: Bench (up to 10 players) - NO POINTS</span>
            </div>
        </div>
        
        <!-- Cancha de baloncesto mejorada -->
        <div class="court-container">
            <div class="court">
                <!-- L√≠neas de la cancha -->
                <div class="center-line"></div>
                <div class="center-circle"></div>
                
                <div class="three-point-left"></div>
                <div class="three-point-right"></div>
                
                <div class="key-left"></div>
                <div class="key-right"></div>
                
                <div class="free-throw-left"></div>
                <div class="free-throw-right"></div>
                
                <div class="free-throw-circle-left"></div>
                <div class="free-throw-circle-right"></div>
                
                <div class="basket-left"></div>
                <div class="basket-right"></div>
                
                <div class="backboard-left"></div>
                <div class="backboard-right"></div>
                
                <!-- Posiciones de jugadores (ZONA VERDE - TITULARES) -->
                <div class="player-slots">
                    <div class="player-slot slot-top" data-position="1" id="position-1">
                        <div class="empty-slot" style="color: rgba(255, 255, 255, 0.7); font-size: 0.8rem; text-align: center; font-weight: 600;">STARTER 1<br><small style="color: #00ff80;">‚úÖ EARNS POINTS</small></div>
                    </div>
                    <div class="player-slot slot-bottom" data-position="2" id="position-2">
                        <div class="empty-slot" style="color: rgba(255, 255, 255, 0.7); font-size: 0.8rem; text-align: center; font-weight: 600;">STARTER 2<br><small style="color: #00ff80;">‚úÖ EARNS POINTS</small></div>
                    </div>
                    <div class="player-slot slot-center" data-position="3" id="position-3">
                        <div class="empty-slot" style="color: rgba(255, 255, 255, 0.7); font-size: 0.8rem; text-align: center; font-weight: 600;">STARTER 3<br><small style="color: #00ff80;">‚úÖ EARNS POINTS</small></div>
                    </div>
                    <div class="player-slot slot-left" data-position="4" id="position-4">
                        <div class="empty-slot" style="color: rgba(255, 255, 255, 0.7); font-size: 0.8rem; text-align: center; font-weight: 600;">STARTER 4<br><small style="color: #00ff80;">‚úÖ EARNS POINTS</small></div>
                    </div>
                    <div class="player-slot slot-right" data-position="5" id="position-5">
                        <div class="empty-slot" style="color: rgba(255, 255, 255, 0.7); font-size: 0.8rem; text-align: center; font-weight: 600;">STARTER 5<br><small style="color: #00ff80;">‚úÖ EARNS POINTS</small></div>
                    </div>
                </div>
            </div>
            
            <!-- √Årea de banca (ZONA ROJA - SUPLENTES) primera fila -->
            <div class="bench-container">
                <div class="bench-slot" data-position="6" id="bench-1">
                    <div class="empty-slot" style="color: rgba(255, 255, 255, 0.7); font-size: 0.7rem; text-align: center; font-weight: 600;">BENCH 1<br><small style="color: #ff6b6b;">‚ùå NO POINTS</small></div>
                </div>
                <div class="bench-slot" data-position="7" id="bench-2">
                    <div class="empty-slot" style="color: rgba(255, 255, 255, 0.7); font-size: 0.7rem; text-align: center; font-weight: 600;">BENCH 2<br><small style="color: #ff6b6b;">‚ùå NO POINTS</small></div>
                </div>
                <div class="bench-slot" data-position="8" id="bench-3">
                    <div class="empty-slot" style="color: rgba(255, 255, 255, 0.7); font-size: 0.7rem; text-align: center; font-weight: 600;">BENCH 3<br><small style="color: #ff6b6b;">‚ùå NO POINTS</small></div>
                </div>
                <div class="bench-slot" data-position="9" id="bench-4">
                    <div class="empty-slot" style="color: rgba(255, 255, 255, 0.7); font-size: 0.7rem; text-align: center; font-weight: 600;">BENCH 4<br><small style="color: #ff6b6b;">‚ùå NO POINTS</small></div>
                </div>
                <div class="bench-slot" data-position="10" id="bench-5">
                    <div class="empty-slot" style="color: rgba(255, 255, 255, 0.7); font-size: 0.7rem; text-align: center; font-weight: 600;">BENCH 5<br><small style="color: #ff6b6b;">‚ùå NO POINTS</small></div>
                </div>
            </div>
            
            <!-- √Årea de banca adicional segunda fila -->
            <div class="bench-container-2">
                <div class="bench-slot" data-position="11" id="bench-6">
                    <div class="empty-slot" style="color: rgba(255, 255, 255, 0.7); font-size: 0.7rem; text-align: center; font-weight: 600;">BENCH 6<br><small style="color: #ff6b6b;">‚ùå NO POINTS</small></div>
                </div>
                <div class="bench-slot" data-position="12" id="bench-7">
                    <div class="empty-slot" style="color: rgba(255, 255, 255, 0.7); font-size: 0.7rem; text-align: center; font-weight: 600;">BENCH 7<br><small style="color: #ff6b6b;">‚ùå NO POINTS</small></div>
                </div>
                <div class="bench-slot" data-position="13" id="bench-8">
                    <div class="empty-slot" style="color: rgba(255, 255, 255, 0.7); font-size: 0.7rem; text-align: center; font-weight: 600;">BENCH 8<br><small style="color: #ff6b6b;">‚ùå NO POINTS</small></div>
                </div>
                <div class="bench-slot" data-position="14" id="bench-9">
                    <div class="empty-slot" style="color: rgba(255, 255, 255, 0.7); font-size: 0.7rem; text-align: center; font-weight: 600;">BENCH 9<br><small style="color: #ff6b6b;">‚ùå NO POINTS</small></div>
                </div>
                <div class="bench-slot" data-position="15" id="bench-10">
                    <div class="empty-slot" style="color: rgba(255, 255, 255, 0.7); font-size: 0.7rem; text-align: center; font-weight: 600;">BENCH 10<br><small style="color: #ff6b6b;">‚ùå NO POINTS</small></div>
                </div>
            </div>
        </div>
        
        <!-- Botones de acci√≥n mejorados -->
        <div class="action-buttons">
            <button class="nav-button" id="clear-team-btn">CLEAR TEAM</button>
            <button class="nav-button" id="save-team-btn-2" style="border-color: #00ff80; color: #00ff80; box-shadow: 0 0 20px rgba(0, 255, 128, 0.3);">SAVE TEAM</button>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Variables
            const playerSlots = document.querySelectorAll('.player-slot, .bench-slot');
            const clearTeamBtn = document.getElementById('clear-team-btn');
            const saveTeamBtn = document.getElementById('save-team-btn');
            const saveTeamBtn2 = document.getElementById('save-team-btn-2');
            const draftButton = document.getElementById('draft-button');
            const jornadaStatus = document.getElementById('jornada-status');
            const statusMessage = document.getElementById('status-message');
            
            let draggedCard = null;
            let playersData = {};
            let currentJornada = null;
            let isLineupLocked = false;
            
            // Team data
            let teamData = {
                position1: null,
                position2: null,
                position3: null,
                position4: null,
                position5: null,
                bench1: null,
                bench2: null,
                bench3: null,
                bench4: null,
                bench5: null,
                bench6: null,
                bench7: null,
                bench8: null,
                bench9: null,
                bench10: null
            };
            
            // üÜï INICIALIZACI√ìN CON VERIFICACIONES
            init();
            
            async function init() {
                try {
                    // Verificar estado de draft del usuario
                    await checkUserDraftStatus();
                    
                    // Cargar datos de jugadores
                    await loadPlayersData();
                    
                    // Verificar estado de jornada actual
                    await checkJornadaStatus();
                    
                    // Cargar equipo guardado
                    await loadSavedTeam();
                    
                    // Setup drag and drop si no est√° bloqueado
                    if (!isLineupLocked) {
                        setupDragAndDrop();
                    }
                    
                    // Configurar event listeners
                    setupEventListeners();
                    
                } catch (error) {
                    console.error('Error during initialization:', error);
                    showJornadaStatus('error', '‚ùå Error loading data. Please refresh the page.');
                }
            }
            
            // üÜï VERIFICAR ESTADO DE DRAFT
            async function checkUserDraftStatus() {
                try {
                    const authToken = localStorage.getItem('authToken');
                    const userData = JSON.parse(localStorage.getItem('userData') || '{}');
                    
                    if (!authToken || !userData.id) {
                        // No hay sesi√≥n, deshabilitar draft button
                        if (draftButton) {
                            draftButton.classList.add('disabled');
                            draftButton.setAttribute('title', 'Please login to draft players');
                            draftButton.href = 'login.html';
                        }
                        return;
                    }
                    
                    // Verificar si ya hizo draft
                    if (userData.has_drafted) {
                        // Ya hizo draft, deshabilitar bot√≥n
                        if (draftButton) {
                            draftButton.classList.add('disabled');
                            draftButton.textContent = 'DRAFT COMPLETED';
                            draftButton.setAttribute('title', 'You have already completed your draft');
                            draftButton.removeAttribute('href');
                            draftButton.onclick = (e) => {
                                e.preventDefault();
                                alert('You have already completed your player draft. Each manager can only draft once.');
                            };
                        }
                    }
                    
                } catch (error) {
                    console.error('Error checking draft status:', error);
                }
            }
            
            // üÜï VERIFICAR ESTADO DE JORNADA
            async function checkJornadaStatus() {
                try {
                    currentJornada = await getCurrentJornada();
                    
                    if (!currentJornada) {
                        showJornadaStatus('warning', '‚ö†Ô∏è No active game week found. Administrator needs to create a game week.');
                        disableTeamActions();
                        return;
                    }
                    
                    // Verificar si la jornada est√° bloqueada
                    if (currentJornada.lineup_locked) {
                        isLineupLocked = true;
                        showJornadaStatus('locked', 
                            `üîí Lineups are LOCKED for Week ${currentJornada.week_number}. ` +
                            `You cannot modify your team after stats have been uploaded.`
                        );
                        disableTeamActions();
                        lockAllSlots();
                    } else {
                        showJornadaStatus('success', 
                            `‚úÖ Week ${currentJornada.week_number} is ACTIVE. You can modify your team lineup.`
                        );
                    }
                    
                } catch (error) {
                    console.error('Error checking jornada status:', error);
                    showJornadaStatus('error', '‚ùå Error checking game week status.');
                }
            }
            
            function showJornadaStatus(type, message) {
                jornadaStatus.style.display = 'block';
                statusMessage.textContent = message;
                
                // Resetear clases
                jornadaStatus.classList.remove('locked', 'warning', 'success');
                
                // Agregar clase seg√∫n tipo
                if (type === 'locked') {
                    jornadaStatus.classList.add('locked');
                } else if (type === 'warning') {
                    jornadaStatus.classList.add('warning');
                }
                // 'success' usa los estilos por defecto (verde)
            }
            
            function disableTeamActions() {
                // Deshabilitar botones de acci√≥n
                if (saveTeamBtn) {
                    saveTeamBtn.classList.add('disabled');
                    saveTeamBtn.disabled = true;
                    saveTeamBtn.textContent = 'LOCKED';
                }
                if (saveTeamBtn2) {
                    saveTeamBtn2.classList.add('disabled');
                    saveTeamBtn2.disabled = true;
                    saveTeamBtn2.textContent = 'LOCKED';
                }
                if (clearTeamBtn) {
                    clearTeamBtn.classList.add('disabled');
                    clearTeamBtn.disabled = true;
                }
            }
            
            function lockAllSlots() {
                // Agregar clase locked a todos los slots
                playerSlots.forEach(slot => {
                    slot.classList.add('locked');
                });
            }
            
            function setupEventListeners() {
                // Clear team button
                if (clearTeamBtn && !clearTeamBtn.disabled) {
                    clearTeamBtn.addEventListener('click', function() {
                        if (!isLineupLocked) {
                            clearTeam();
                        }
                    });
                }
                
                // Save team buttons
                if (saveTeamBtn && !saveTeamBtn.disabled) {
                    saveTeamBtn.addEventListener('click', function() {
                        if (!isLineupLocked) {
                            saveTeam();
                        }
                    });
                }
                
                if (saveTeamBtn2 && !saveTeamBtn2.disabled) {
                    saveTeamBtn2.addEventListener('click', function() {
                        if (!isLineupLocked) {
                            saveTeam();
                        }
                    });
                }
                
                // Efecto de movimiento de los resplandores
                const glowEffects = document.querySelectorAll('.circle-glow');
                window.addEventListener('mousemove', function(e) {
                    glowEffects.forEach((glow, index) => {
                        const offsetX = (e.clientX / window.innerWidth - 0.5) * 100;
                        const offsetY = (e.clientY / window.innerHeight - 0.5) * 100;
                        
                        setTimeout(() => {
                            glow.style.transform = `translate(${offsetX * (index + 1) * 0.2}px, ${offsetY * (index + 1) * 0.2}px)`;
                        }, index * 100);
                    });
                });
            }
            
            // Cargar datos de jugadores desde la API
            async function loadPlayersData() {
                try {
                    console.log('üîÑ Loading players data...');
                    const response = await fetch('/api/players');
                    if (response.ok) {
                        const players = await response.json();
                        console.log('üìä Players received:', players.length);
                        
                        // Crear un mapa de jugadores por ID para acceso r√°pido
                        players.forEach(player => {
                            playersData[player.id] = player;
                            console.log(`üë§ Player ${player.id}: ${player.name} - Team: ${player.team}`);
                        });
                        console.log('‚úÖ Players data loaded:', Object.keys(playersData).length, 'players');
                        console.log('üîç Sample player data:', playersData[Object.keys(playersData)[0]]);
                    } else {
                        console.error('‚ùå Failed to load players:', response.status);
                    }
                } catch (error) {
                    console.error('‚ùå Error loading players data:', error);
                }
            }
            
            function setupDragAndDrop() {
                playerSlots.forEach(slot => {
                    // Solo setup si no est√° bloqueado
                    if (slot.classList.contains('locked')) return;
                    
                    slot.addEventListener('dragover', function(e) {
                        e.preventDefault();
                        this.style.borderColor = '#00f0ff';
                        this.style.boxShadow = '0 0 10px rgba(0, 240, 255, 0.5)';
                    });
                    
                    slot.addEventListener('dragleave', function() {
                        // Restore original colors based on zone
                        if (parseInt(this.dataset.position) <= 5) {
                            this.style.borderColor = '#00ff80';
                        } else {
                            this.style.borderColor = '#ff6b6b';
                        }
                        this.style.boxShadow = 'none';
                    });
                    
                    slot.addEventListener('drop', function(e) {
                        e.preventDefault();
                        
                        // No permitir drop si est√° bloqueado
                        if (isLineupLocked || this.classList.contains('locked')) {
                            return;
                        }
                        
                        // Reset slot styling to original colors
                        if (parseInt(this.dataset.position) <= 5) {
                            this.style.borderColor = '#00ff80';
                        } else {
                            this.style.borderColor = '#ff6b6b';
                        }
                        this.style.boxShadow = 'none';
                        
                        if (!draggedCard) return;
                        
                        // Handle player swap
                        const currentPlayerId = this.dataset.playerId;
                        const draggedPlayerId = draggedCard.dataset.playerId;
                        const originalSlot = draggedCard.parentElement;
                        
                        // Clear both slots
                        this.innerHTML = '';
                        originalSlot.innerHTML = '';
                        
                        // Move dragged player to new slot
                        const newCard = createPlayerCard(draggedPlayerId, this.dataset.position);
                        this.appendChild(newCard);
                        this.classList.add('has-player');
                        this.dataset.playerId = draggedPlayerId;
                        
                        // Move original player to dragged slot (if exists)
                        if (currentPlayerId) {
                            const swappedCard = createPlayerCard(currentPlayerId, originalSlot.dataset.position);
                            originalSlot.appendChild(swappedCard);
                        } else {
                            // Reset original slot to empty state
                            resetSlotToEmpty(originalSlot);
                        }
                        
                        // Update team data
                        updateTeamData();
                        
                        draggedCard = null;
                    });
                });
            }
            
            function createPlayerCard(playerId, position) {
                console.log('üé¥ Creating card for player:', playerId);
                
                const playerInfo = playersData[playerId];
                const playerName = playerInfo ? playerInfo.name : `Player ${playerId}`;
                const teamName = playerInfo ? playerInfo.team : 'Warriors';
                
                console.log('üé¥ Player info:', {
                    id: playerId,
                    name: playerName,
                    team: teamName,
                    fullPlayerInfo: playerInfo
                });
                
                // Crear el elemento de la carta
                const card = document.createElement('div');
                card.className = 'player-card';
                card.draggable = !isLineupLocked;
                card.dataset.playerId = playerId;
                card.dataset.originalPosition = position;
                
                // Obtener la ruta del logo
                let logoPath = '/assets/images/logos/warriors.png'; // Default
                if (typeof getTeamLogoPath === 'function') {
                    logoPath = getTeamLogoPath(teamName);
                    console.log('üñºÔ∏è Logo path for', playerName, ':', logoPath);
                } else {
                    console.error('‚ùå getTeamLogoPath function not available!');
                }
                
                card.innerHTML = `
                    <div class="card-border"></div>
                    <div class="corner top-left"></div>
                    <div class="corner top-right"></div>
                    <div class="corner bottom-left"></div>
                    <div class="corner bottom-right"></div>
                    
                    <div class="player-name">${playerName.toUpperCase()}</div>
                    <div class="player-position">${playerInfo?.position || 'SF'} - ${teamName}</div>
                    
                    <div class="player-image-container">
                        <img src="${logoPath}" 
                            alt="${teamName} Logo" 
                            class="team-logo-image"
                            onload="console.log('‚úÖ Logo loaded successfully:', '${logoPath}')"
                            onerror="console.error('‚ùå Logo failed to load:', '${logoPath}'); this.src='/assets/images/logos/warriors.png';"
                            style="width: 100%; height: 100%; object-fit: contain;">
                    </div>
                    
                    <div class="stats-container">
                        <div class="stat-item">
                            <span class="stat-label">SPD</span>
                            <span class="stat-value">${playerInfo?.stats?.speed || Math.floor(Math.random() * 30) + 70}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">DEF</span>
                            <span class="stat-value">${playerInfo?.stats?.defense || Math.floor(Math.random() * 30) + 70}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">SHT</span>
                            <span class="stat-value">${playerInfo?.stats?.shooting || Math.floor(Math.random() * 30) + 70}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">OFF</span>
                            <span class="stat-value">${playerInfo?.stats?.offense || Math.floor(Math.random() * 30) + 70}</span>
                        </div>
                    </div>
                `;
                
                // Set up drag events solo si no est√° bloqueado
                if (!isLineupLocked) {
                    card.addEventListener('dragstart', function(e) {
                        draggedCard = this;
                        setTimeout(() => {
                            this.style.opacity = '0.4';
                        }, 0);
                    });
                    
                    card.addEventListener('dragend', function() {
                        this.style.opacity = '1';
                    });
                }
                
                return card;
            }
            
            function resetSlotToEmpty(slot) {
                const position = parseInt(slot.dataset.position);
                let slotContent = '';
                
                if (position <= 5) {
                    // Slots de titulares (zona verde)
                    slotContent = `<div class="empty-slot">STARTER ${position}<br><small>‚úÖ EARNS POINTS</small></div>`;
                } else {
                    // Slots de suplentes (zona roja)
                    const benchNumber = position - 5;
                    slotContent = `<div class="empty-slot">BENCH ${benchNumber}<br><small>‚ùå NO POINTS</small></div>`;
                }
                
                slot.innerHTML = slotContent;
                slot.classList.remove('has-player');
                delete slot.dataset.playerId;
            }
            
            function updateTeamData() {
                // Reset team data
                for (let key in teamData) {
                    teamData[key] = null;
                }
                
                // Update with current slots
                playerSlots.forEach(slot => {
                    if (slot.dataset.playerId) {
                        const position = parseInt(slot.dataset.position);
                        if (position <= 5) {
                            teamData[`position${position}`] = slot.dataset.playerId;
                        } else {
                            teamData[`bench${position - 5}`] = slot.dataset.playerId;
                        }
                    }
                });
            }
            
            function clearTeam() {
                if (isLineupLocked) {
                    alert('Cannot clear team - lineups are locked for this week.');
                    return;
                }
                
                playerSlots.forEach(slot => {
                    resetSlotToEmpty(slot);
                });
                
                // Reset team data
                for (let key in teamData) {
                    teamData[key] = null;
                }
                
                // Save empty team to localStorage
                localStorage.setItem('basketballTeam', JSON.stringify(teamData));
                
                // Efecto visual de confirmaci√≥n
                const courtContainer = document.querySelector('.court-container');
                courtContainer.style.boxShadow = '0 0 30px rgba(0, 240, 255, 0.7)';
                setTimeout(() => {
                    courtContainer.style.boxShadow = '';
                }, 500);
            }
            
            // üÜï FUNCI√ìN MEJORADA PARA OBTENER JORNADA ACTUAL
            async function getCurrentJornada() {
                try {
                    console.log('üîç Looking for current jornada...');
                    
                    const authToken = localStorage.getItem('authToken');
                    const response = await fetch('/api/admin/jornadas', {
                        headers: {
                            'Authorization': `Bearer ${authToken}`
                        }
                    });

                    if (!response.ok) {
                        console.error('‚ùå Failed to fetch jornadas:', response.status);
                        // Fallback: intentar sin autenticaci√≥n para usuarios regulares
                        const publicResponse = await fetch('/api/leaderboards');
                        if (publicResponse.ok) {
                            console.log('üìä Leaderboards accessible, using fallback jornada detection');
                            return { id: 1, week_number: 1, lineup_locked: false, message: 'Using fallback jornada' };
                        }
                        throw new Error('Cannot access game weeks');
                    }

                    const jornadas = await response.json();
                    console.log('üìÖ Jornadas found:', jornadas.length);

                    if (jornadas.length === 0) {
                        throw new Error('NO_JORNADAS_EXIST');
                    }

                    // 1. Buscar jornada activa
                    let currentJornada = jornadas.find(j => j.is_current);
                    
                    if (currentJornada) {
                        console.log('‚úÖ Found current jornada:', currentJornada.week_number);
                        return currentJornada;
                    }

                    // 2. Si no hay activa, usar la m√°s reciente
                    if (jornadas.length > 0) {
                        currentJornada = jornadas[0]; // Ya ordenado por week_number DESC
                        console.log('‚ö†Ô∏è Using latest jornada:', currentJornada.week_number);
                        return currentJornada;
                    }

                    throw new Error('NO_JORNADAS_AVAILABLE');

                } catch (error) {
                    console.error('‚ùå Error getting current jornada:', error);
                    return null;
                }
            }
            
            // üÜï FUNCI√ìN CORREGIDA PARA GUARDAR EQUIPO CON VERIFICACI√ìN DE BLOQUEO
            async function saveTeam() {
                if (isLineupLocked) {
                    alert('Cannot save team - lineups are locked for this week. Please wait for administrator to unlock or create a new week.');
                    return;
                }
                
                try {
                    // Verificar si el usuario est√° logueado
                    const authToken = localStorage.getItem('authToken');
                    const userData = JSON.parse(localStorage.getItem('userData') || '{}');
                    
                    if (!authToken || !userData.id) {
                        alert('You need to be logged in to save your team');
                        window.location.href = 'login.html';
                        return;
                    }

                    // Actualizar team data antes de guardar
                    updateTeamData();
                    
                    console.log('üíæ Saving team data:', teamData);
                    
                    // Validar que hay al menos algunos jugadores titulares
                    const starters = Object.values({
                        position1: teamData.position1,
                        position2: teamData.position2,
                        position3: teamData.position3,
                        position4: teamData.position4,
                        position5: teamData.position5
                    }).filter(id => id !== null);
                    
                    if (starters.length === 0) {
                        alert('Please add at least one starter to your team (green zone on court)');
                        return;
                    }

                    // Verificar jornada actual
                    if (!currentJornada) {
                        currentJornada = await getCurrentJornada();
                        if (!currentJornada) {
                            alert('‚ùå No active game week found!\n\nAn administrator needs to create a game week first.');
                            return;
                        }
                    }

                    // üÜï VERIFICAR NUEVAMENTE SI SE BLOQUE√ì DURANTE LA SESI√ìN
                    const jornadaCheck = await fetch(`/api/admin/jornadas?id=${currentJornada.id}`, {
                        headers: {
                            'Authorization': `Bearer ${authToken}`
                        }
                    });
                    
                    if (jornadaCheck.ok) {
                        const updatedJornada = await jornadaCheck.json();
                        if (updatedJornada.lineup_locked) {
                            alert('‚ö†Ô∏è Lineups were just locked for this week!\n\nYou can no longer modify your team until administrator unlocks it.');
                            // Recargar la p√°gina para reflejar el estado actual
                            window.location.reload();
                            return;
                        }
                    }

                    // Preparar los datos para la API
                    const teamDataForAPI = {
                        user_id: userData.id,
                        jornada_id: currentJornada.id,
                        players: []
                    };

                    // ‚úÖ AGREGAR JUGADORES TITULARES (zona verde - S√ç SUMAN PUNTOS)
                    for (let i = 1; i <= 5; i++) {
                        const playerId = teamData[`position${i}`];
                        if (playerId) {
                            teamDataForAPI.players.push({
                                player_id: parseInt(playerId),
                                position_type: 'starter',  // ‚úÖ TITULARES
                                position_number: i
                            });
                            console.log(`‚úÖ STARTER added: Player ${playerId} at position ${i}`);
                        }
                    }

                    // ‚ùå AGREGAR JUGADORES SUPLENTES (zona roja - NO SUMAN PUNTOS)
                    for (let i = 1; i <= 10; i++) {
                        const playerId = teamData[`bench${i}`];
                        if (playerId) {
                            teamDataForAPI.players.push({
                                player_id: parseInt(playerId),
                                position_type: 'bench',    // ‚ùå SUPLENTES
                                position_number: i
                            });
                            console.log(`‚ùå BENCH added: Player ${playerId} at bench ${i} (no points)`);
                        }
                    }

                    console.log('üöÄ Team data for API:', teamDataForAPI);
                    console.log(`‚úÖ Total starters: ${teamDataForAPI.players.filter(p => p.position_type === 'starter').length}`);
                    console.log(`‚ùå Total bench: ${teamDataForAPI.players.filter(p => p.position_type === 'bench').length}`);

                    // Llamar a la API para guardar el equipo
                    const response = await fetch('/api/user-teams', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify(teamDataForAPI)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        
                        // Manejar error espec√≠fico de lineup bloqueado
                        if (errorData.message && errorData.message.includes('locked')) {
                            alert('‚ö†Ô∏è ' + errorData.message);
                            // Recargar para mostrar estado bloqueado
                            window.location.reload();
                            return;
                        }
                        
                        throw new Error(errorData.message || 'Failed to save team');
                    }

                    const result = await response.json();
                    console.log('‚úÖ Team saved successfully:', result);

                    // Guardar tambi√©n en localStorage como backup
                    localStorage.setItem('basketballTeam', JSON.stringify(teamData));
                    localStorage.setItem('lastSavedTeam', JSON.stringify({
                        ...teamDataForAPI,
                        savedAt: new Date().toISOString()
                    }));

                    // Efecto visual de confirmaci√≥n
                    showSaveSuccess();

                    // Mostrar resumen al usuario
                    const startersCount = teamDataForAPI.players.filter(p => p.position_type === 'starter').length;
                    const benchCount = teamDataForAPI.players.filter(p => p.position_type === 'bench').length;
                    
                    setTimeout(() => {
                        alert(`üèÄ Team saved successfully for Week ${currentJornada.week_number}!\n\n‚úÖ Starters (will earn points): ${startersCount}\n‚ùå Bench (won't earn points): ${benchCount}\n\nOnly players in the GREEN ZONE will earn fantasy points!`);
                    }, 1000);

                } catch (error) {
                    console.error('‚ùå Error saving team:', error);
                    alert(`‚ùå Error saving team:\n\n${error.message}\n\nPlease try again or contact support.`);
                }
            }

            // FUNCI√ìN CORREGIDA PARA CARGAR EQUIPO
            async function loadSavedTeam() {
                try {
                    // Verificar si hay jugadores drafteados pendientes
                    const draftedPlayers = localStorage.getItem('draftedPlayers');
                    if (draftedPlayers) {
                        const players = JSON.parse(draftedPlayers);
                        console.log('Loading drafted players:', players);
                        
                        // Colocar jugadores en la banca (zona roja)
                        for (let i = 0; i < Math.min(players.length, 10); i++) {
                            teamData[`bench${i + 1}`] = players[i].id.toString();
                        }
                        
                        // Limpiar drafted players ya que los hemos cargado
                        localStorage.removeItem('draftedPlayers');
                        
                        // Guardar el equipo actualizado
                        localStorage.setItem('basketballTeam', JSON.stringify(teamData));
                    }

                    // Cargar equipo desde la API si el usuario est√° logueado
                    const authToken = localStorage.getItem('authToken');
                    const userData = JSON.parse(localStorage.getItem('userData') || '{}');
                    
                    if (authToken && userData.id && currentJornada) {
                        await loadTeamFromAPI();
                    }

                    // Si no hay datos de la API, cargar desde localStorage
                    const savedTeam = localStorage.getItem('basketballTeam');
                    if (savedTeam) {
                        const loadedTeamData = JSON.parse(savedTeam);
                        Object.assign(teamData, loadedTeamData);
                        console.log('Loading saved team from localStorage:', teamData);
                    }

                    // Esperar a que carguen los datos de jugadores
                    setTimeout(() => {
                        renderTeamOnField();
                    }, 500);

                } catch (error) {
                    console.error('Error loading saved team:', error);
                }
            }

            // Nueva funci√≥n para cargar equipo desde la API
            async function loadTeamFromAPI() {
                try {
                    const authToken = localStorage.getItem('authToken');
                    const userData = JSON.parse(localStorage.getItem('userData') || '{}');
                    
                    if (!currentJornada) {
                        console.log('No current jornada found');
                        return;
                    }

                    // Obtener equipo del usuario para la jornada actual
                    const response = await fetch(`/api/user-teams?user_id=${userData.id}&jornada_id=${currentJornada.id}`, {
                        headers: {
                            'Authorization': `Bearer ${authToken}`
                        }
                    });

                    if (response.ok) {
                        const teamFromAPI = await response.json();
                        console.log('Team loaded from API:', teamFromAPI);
                        
                        if (teamFromAPI.players && teamFromAPI.players.length > 0) {
                            // Limpiar teamData actual
                            for (let key in teamData) {
                                teamData[key] = null;
                            }
                            
                            // Cargar jugadores desde la API
                            teamFromAPI.players.forEach(player => {
                                if (player.position_type === 'starter') {
                                    teamData[`position${player.position_number}`] = player.player_id.toString();
                                } else if (player.position_type === 'bench') {
                                    teamData[`bench${player.position_number}`] = player.player_id.toString();
                                }
                            });
                            
                            console.log('Team data loaded from API:', teamData);
                            
                            // üÜï VERIFICAR SI EST√Å BLOQUEADO DESDE LA API
                            if (teamFromAPI.lineup_locked) {
                                isLineupLocked = true;
                                showJornadaStatus('locked', 
                                    `üîí Lineups are LOCKED for Week ${currentJornada.week_number}. ` +
                                    `You cannot modify your team after stats have been uploaded.`
                                );
                                disableTeamActions();
                                lockAllSlots();
                            }
                        }
                    }
                } catch (error) {
                    console.error('Error loading team from API:', error);
                }
            }

            // Funci√≥n para renderizar el equipo en el campo
            function renderTeamOnField() {
                // Cargar jugadores en las posiciones de campo (titulares)
                for (let i = 1; i <= 5; i++) {
                    const playerId = teamData[`position${i}`];
                    if (playerId) {
                        const slot = document.getElementById(`position-${i}`);
                        if (slot) {
                            loadPlayerToSlot(playerId, slot, i);
                        }
                    }
                }
                
                // Cargar jugadores en la banca (suplentes)
                for (let i = 1; i <= 10; i++) {
                    const playerId = teamData[`bench${i}`];
                    if (playerId) {
                        const slot = document.getElementById(`bench-${i}`);
                        if (slot) {
                            loadPlayerToSlot(playerId, slot, i + 5);
                        }
                    }
                }
            }

            // Funci√≥n mejorada para mostrar √©xito al guardar
            function showSaveSuccess() {
                const btns = [saveTeamBtn, saveTeamBtn2];
                
                btns.forEach(btn => {
                    if (btn && !btn.disabled) {
                        const originalText = btn.textContent;
                        btn.innerHTML = '‚úì TEAM SAVED!';
                        btn.style.backgroundColor = 'rgba(0, 255, 128, 0.3)';
                        btn.style.borderColor = '#00ff80';
                        btn.style.color = '#00ff80';
                        btn.style.boxShadow = '0 0 20px rgba(0, 255, 128, 0.7)';
                        
                        setTimeout(() => {
                            btn.textContent = originalText;
                            btn.style.backgroundColor = '';
                            btn.style.borderColor = '';
                            btn.style.color = '';
                            btn.style.boxShadow = '';
                        }, 3000);
                    }
                });
            }
            
            function loadPlayerToSlot(playerId, slot, position) {
                if (!slot) return;
                
                console.log(`Loading player ${playerId} to slot ${position}`);
                
                const playerCard = createPlayerCard(playerId, position);
                slot.innerHTML = '';
                slot.appendChild(playerCard);
                slot.classList.add('has-player');
                slot.dataset.playerId = playerId;
            }
        });

        // üéµ INICIALIZAR M√öSICA
        if (typeof initBackgroundMusic === 'function') {
            initBackgroundMusic();
        }


    </script>
</body>
</html>